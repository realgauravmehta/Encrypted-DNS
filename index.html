<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Encrypted DNS Profile Generator for Apple Devices</title>
  <meta name="description" content="Securely create and download encrypted DNS profiles (DoH/DoT) for iOS, iPadOS, and macOS devices with enhanced privacy protection.">
  <meta name="keywords" content="dns, mobileconfig, doh, dot, encrypted dns, apple, ios, macos, nextdns, controld, mullvad, cloudflare, privacy, security">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
      transition: background-color 0.3s, color 0.3s;
    }
    :root {
      --bg-primary: #000;
      --bg-secondary: #0a0a0a;
      --bg-tertiary: #111;
      --bg-card: rgba(16,16,16,0.7);
      --bg-glass: rgba(255,255,255,0.05);
      --text-primary: #e5e5e5;
      --text-secondary: #a3a3a3;
      --text-muted: #737373;
      --accent-primary: #6d28d9;
      --accent-primary-hover: #7c3aed;
      --accent-secondary: #0891b2;
      --accent-success: #059669;
      --accent-warning: #f59e0b;
      --accent-error: #dc2626;
      --border-primary: rgba(255,255,255,0.1);
      --border-secondary: rgba(255,255,255,0.05);
      --border-accent: rgba(109,40,217,0.3);
      --input-bg: rgba(255,255,255,0.03);
      --input-border: rgba(255,255,255,0.1);
      --input-border-focus: var(--accent-primary);
    }
    body.light {
      --bg-primary: #f9fafb;
      --bg-secondary: #fff;
      --bg-tertiary: #eee;
      --bg-card: rgba(240,240,240,0.7);
      --bg-glass: rgba(0,0,0,0.05);
      --text-primary: #222;
      --text-secondary: #444;
      --text-muted: #777;
    }
    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }
    .glass-card {
      background: var(--bg-card);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--border-primary);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .glass-card:hover {
      border-color: var(--border-accent);
      transform: translateY(-2px);
    }
    .form-input {
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      color: var(--text-primary);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .form-input:focus {
      outline: none;
      border-color: var(--input-border-focus);
      box-shadow: 0 0 0 3px rgba(109,40,217,0.2);
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-primary-hover) 100%);
      border: none;
      color: white;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .btn-primary:hover {
      transform: translateY(-2px) scale(1.02);
    }
    .status-success { color: var(--accent-success); }
    .status-warning { color: var(--accent-warning); }
    .status-error { color: var(--accent-error); }
    .provider-table {
      background: var(--bg-glass);
      border: 1px solid var(--border-secondary);
      border-radius: 12px;
      overflow: hidden;
    }
    .provider-table th, .provider-table td { position: relative; }
    .provider-table code {
      background: rgba(109,40,217,0.1);
      color: var(--accent-primary);
      padding: 4px 8px;
      border-radius: 6px;
    }
    .copy-icon-table {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--text-muted);
      transition: color 0.2s;
      display: none;
    }
    .provider-table tr:hover .copy-icon-table {
      display: block;
    }
    .copy-icon-table:hover {
      color: var(--text-primary);
    }
    .fade-in { animation: fadeIn 0.6s ease-out; }
    .slide-up { animation: slideUp 0.6s ease-out; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .message-box {
      border-radius: 8px;
      padding: 12px;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .error-message {
      color: var(--accent-error);
      background: rgba(220,38,38,0.1);
      border: 1px solid rgba(220,38,38,0.2);
    }
    .success-message {
      color: var(--accent-success);
      background: rgba(5,150,105,0.1);
      border: 1px solid rgba(5,150,105,0.2);
    }
    .loading-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    /* Modal animation */
    .modal {
      opacity: 0;
      transform: scale(0.98);
      transition: opacity 0.3s, transform 0.3s;
    }
    .modal.active {
      opacity: 1;
      transform: scale(1);
    }
    @media (max-width: 640px) {
      .glass-card, .provider-table {
        border-radius: 0.75rem;
        padding: 1rem;
      }
      .fade-in, .slide-up { animation-duration: 0.3s; }
    }
  </style>
</head>
<body class="min-h-screen">
  <div class="flex justify-between items-center w-full max-w-5xl mx-auto mt-4 px-2 sm:px-4">
    <div>
      <select id="lang-select" class="form-input px-2 py-1 rounded-xl text-sm" aria-label="Language select">
        <option value="en">English</option>
        <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
        <option value="fr">FranÃ§ais</option>
        <option value="es">EspaÃ±ol</option>
        <option value="ja">æ—¥æœ¬èª</option>
        <option value="ko">í•œêµ­ì–´</option>
        <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="zh">ä¸­æ–‡</option>
      </select>
    </div>
    <button id="theme-toggle" class="btn-primary px-4 py-2 rounded-xl text-sm font-semibold" aria-label="Toggle theme">ğŸŒ™/â˜€ï¸</button>
  </div>
  <main class="w-full max-w-5xl mx-auto py-8 px-2 sm:px-4">
    <div class="glass-card rounded-3xl overflow-hidden fade-in">
      <!-- Header -->
      <header class="p-8 text-center border-b border-[var(--border-primary)]">
        <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-[var(--accent-primary)] to-[var(--accent-secondary)] bg-clip-text text-transparent mb-2" id="main-title">
          Encrypted DNS Profile Generator
        </h1>
        <p class="text-[var(--text-secondary)] text-base md:text-lg" id="main-desc">
          Create secure DNS profiles for iOS 14+, iPadOS 14+, and macOS 11+
        </p>
      </header>

      <div class="p-6 md:p-8">
        <!-- Tab Navigation -->
        <nav class="flex justify-center mb-8" role="tablist">
          <div class="flex p-2 rounded-2xl glass-card">
            <button id="tab-generator" class="glass-button active px-6 py-3 rounded-xl font-semibold transition-all duration-300" role="tab" aria-selected="true" aria-controls="content-generator" tabindex="0">Generator</button>
            <button id="tab-help" class="glass-button px-6 py-3 rounded-xl font-semibold transition-all duration-300" role="tab" aria-selected="false" aria-controls="content-help" tabindex="0">Help & Info</button>
          </div>
        </nav>

        <!-- Generator Tab Content -->
        <div id="content-generator" class="tab-content active slide-up" role="tabpanel" aria-labelledby="tab-generator">
          <form id="dns-form" class="space-y-6" novalidate>
            <div id="form-messages" class="space-y-3" aria-live="polite"></div>

            <!-- Profile Name -->
            <div>
              <label for="profileName" class="block text-sm font-semibold mb-3" id="label-profileName">Profile Name <span class="text-[var(--accent-error)]">*</span></label>
              <input type="text" id="profileName" class="form-input w-full px-4 py-3 rounded-xl" placeholder="e.g., My Secure DNS" required maxlength="50">
            </div>

            <!-- Provider Presets -->
            <div>
              <label for="provider" class="block text-sm font-semibold mb-3" id="label-provider">Provider Preset</label>
              <div class="flex gap-2 mb-2">
                <select id="provider" class="form-input w-full px-4 py-3 rounded-xl appearance-none"></select>
                <button type="button" id="save-preset-btn" class="btn-primary px-4 py-2 rounded-xl text-sm">Save Preset</button>
                <button type="button" id="load-preset-btn" class="btn-primary px-4 py-2 rounded-xl text-sm">Load Preset</button>
              </div>
            </div>

            <!-- Resolver ID -->
            <div id="resolver-id-group" class="hidden">
              <label for="resolverId" class="block text-sm font-semibold mb-3" id="label-resolverId">Resolver ID <span class="text-[var(--accent-error)]">*</span></label>
              <input type="text" id="resolverId" class="form-input w-full px-4 py-3 rounded-xl" placeholder="Enter your unique ID">
            </div>

            <!-- Protocol Selection -->
            <div>
              <label for="protocol" class="block text-sm font-semibold mb-3" id="label-protocol">DNS Protocol</label>
              <select id="protocol" class="form-input w-full px-4 py-3 rounded-xl appearance-none">
                <option value="doh">DNS-over-HTTPS (DoH)</option>
                <option value="dot">DNS-over-TLS (DoT)</option>
              </select>
            </div>

            <!-- DoH/DoT Fields -->
            <div id="doh-fields">
              <label for="dohURL" class="block text-sm font-semibold mb-3" id="label-dohURL">DoH Server URL <span class="text-[var(--accent-error)]">*</span></label>
              <input type="url" id="dohURL" class="form-input w-full px-4 py-3 rounded-xl" placeholder="https://dns.example.com/dns-query" required>
            </div>
            <div id="dot-fields" class="hidden">
              <label for="dotServer" class="block text-sm font-semibold mb-3" id="label-dotServer">DoT Server Hostname <span class="text-[var(--accent-error)]">*</span></label>
              <input type="text" id="dotServer" class="form-input w-full px-4 py-3 rounded-xl" placeholder="dns.example.com">
            </div>

            <!-- Advanced Settings -->
            <div>
              <button type="button" id="advanced-toggle" class="text-sm font-semibold text-[var(--accent-primary)] hover:text-[var(--accent-primary-hover)]">Advanced Settings</button>
              <div id="advanced-settings" class="hidden mt-4">
                <label for="serverIPs" class="block text-sm font-semibold mb-3" id="label-serverIPs">Server IP Addresses (Optional)</label>
                <textarea id="serverIPs" rows="3" class="form-input w-full px-4 py-3 rounded-xl" placeholder="1.1.1.1 (one per line)"></textarea>
              </div>
            </div>

            <div class="pt-4">
              <button type="submit" id="generate-btn" class="btn-primary w-full py-4 px-6 rounded-xl text-base font-semibold">
                <span id="btn-text">Generate & Download Profile</span>
              </button>
            </div>

            <!-- Profile Preview Feature -->
            <div id="profile-preview-container" class="hidden mt-4">
              <h3 class="text-lg font-semibold mb-2" id="preview-title">Profile Preview (XML)</h3>
              <pre id="profile-preview" class="bg-gray-900 text-green-300 rounded-xl p-4 overflow-x-auto"></pre>
            </div>

            <!-- QR Code Generation -->
            <div id="qr-code-container" class="hidden mt-4 text-center">
              <h3 class="text-lg font-semibold mb-2" id="qr-title">Transfer to Device (QR Code)</h3>
              <canvas id="qr-code"></canvas>
            </div>
          </form>
        </div>

        <!-- Help Tab Content -->
        <div id="content-help" class="tab-content hidden" role="tabpanel" aria-labelledby="tab-help">
          <div class="space-y-8">
            <section>
              <h2 class="text-2xl font-bold mb-4" id="what-title">What is Encrypted DNS?</h2>
              <p class="text-[var(--text-secondary)]" id="what-desc">
                Encrypted DNS (like DoH and DoT) secures your DNS queries, preventing others from seeing the websites you visit. This enhances your privacy and security online.
              </p>
            </section>
            <section>
              <h2 class="text-2xl font-bold mb-4" id="trusted-title">Trusted DNS Providers</h2>
              <div class="provider-table">
                <table class="w-full text-left">
                  <thead>
                    <tr>
                      <th class="p-4" id="provider-head">Provider</th>
                      <th class="p-4" id="doh-head">DoH URL</th>
                      <th class="p-4" id="dot-head">DoT Hostname</th>
                    </tr>
                  </thead>
                  <tbody id="provider-info-table"></tbody>
                </table>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer class="w-full max-w-5xl mx-auto py-8 px-4 text-center text-[var(--text-muted)] text-xs">
    <div class="glass-card rounded-3xl p-6">
      <h3 class="font-semibold text-sm text-[var(--text-primary)] mb-2" id="disclaimer-title">Disclaimer</h3>
      <p class="mb-2" id="disclaimer-desc">
        This tool is provided "as is", without warranty of any kind, express or implied. The developer of this tool is not affiliated with any of the DNS providers listed. By using this generator, you accept all risks and responsibilities.
      </p>
    </div>
  </footer>
  <script>
    'use strict';

    class DNSProfileGenerator {
      constructor() {
        // Translations for i18n
        this.translations = {
          en: {
            generator: "Generator",
            help: "Help & Info",
            mainTitle: "Encrypted DNS Profile Generator",
            mainDesc: "Create secure DNS profiles for iOS 14+, iPadOS 14+, and macOS 11+",
            labelProfileName: "Profile Name",
            labelProvider: "Provider Preset",
            labelResolverId: "Resolver ID",
            labelProtocol: "DNS Protocol",
            labelDohURL: "DoH Server URL",
            labelDotServer: "DoT Server Hostname",
            labelServerIPs: "Server IP Addresses (Optional)",
            advanced: "Advanced Settings",
            btnGenerate: "Generate & Download Profile",
            btnSavePreset: "Save Preset",
            btnLoadPreset: "Load Preset",
            whatTitle: "What is Encrypted DNS?",
            whatDesc: "Encrypted DNS (like DoH and DoT) secures your DNS queries, preventing others from seeing the websites you visit. This enhances your privacy and security online.",
            trustedTitle: "Trusted DNS Providers",
            providerHead: "Provider",
            dohHead: "DoH URL",
            dotHead: "DoT Hostname",
            previewTitle: "Profile Preview (XML)",
            qrTitle: "Transfer to Device (QR Code)",
            disclaimerTitle: "Disclaimer",
            disclaimerDesc: "This tool is provided \"as is\", without warranty of any kind, express or implied. The developer of this tool is not affiliated with any of the DNS providers listed. By using this generator, you accept all risks and responsibilities."
          },
          hi: {
            generator: "à¤œà¥‡à¤¨à¤°à¥‡à¤Ÿà¤°",
            help: "à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤”à¤° à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€",
            mainTitle: "à¤à¤¨à¥à¤•à¥à¤°à¤¿à¤ªà¥à¤Ÿà¥‡à¤¡ DNS à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤² à¤œà¤¨à¤°à¥‡à¤Ÿà¤°",
            mainDesc: "iOS 14+, iPadOS 14+, à¤”à¤° macOS 11+ à¤•à¥‡ à¤²à¤¿à¤ à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ DNS à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤² à¤¬à¤¨à¤¾à¤à¤‚",
            labelProfileName: "à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤² à¤¨à¤¾à¤®",
            labelProvider: "à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾ à¤ªà¥à¤°à¥€à¤¸à¥‡à¤Ÿ",
            labelResolverId: "à¤°à¤¿à¤œà¥‰à¤²à¥à¤µà¤° à¤†à¤ˆà¤¡à¥€",
            labelProtocol: "DNS à¤ªà¥à¤°à¥‹à¤Ÿà¥‹à¤•à¥‰à¤²",
            labelDohURL: "DoH à¤¸à¤°à¥à¤µà¤° URL",
            labelDotServer: "DoT à¤¸à¤°à¥à¤µà¤° à¤¹à¥‹à¤¸à¥à¤Ÿà¤¨à¤¾à¤®",
            labelServerIPs: "à¤¸à¤°à¥à¤µà¤° IP à¤à¤¡à¥à¤°à¥‡à¤¸ (à¤µà¥ˆà¤•à¤²à¥à¤ªà¤¿à¤•)",
            advanced: "à¤à¤¡à¤µà¤¾à¤‚à¤¸à¥à¤¡ à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸",
            btnGenerate: "à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤² à¤œà¥‡à¤¨à¤°à¥‡à¤Ÿ à¤”à¤° à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚",
            btnSavePreset: "à¤ªà¥à¤°à¥€à¤¸à¥‡à¤Ÿ à¤¸à¥‡à¤µ à¤•à¤°à¥‡à¤‚",
            btnLoadPreset: "à¤ªà¥à¤°à¥€à¤¸à¥‡à¤Ÿ à¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚",
            whatTitle: "à¤à¤¨à¥à¤•à¥à¤°à¤¿à¤ªà¥à¤Ÿà¥‡à¤¡ DNS à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?",
            whatDesc: "à¤à¤¨à¥à¤•à¥à¤°à¤¿à¤ªà¥à¤Ÿà¥‡à¤¡ DNS (à¤œà¥ˆà¤¸à¥‡ DoH à¤”à¤° DoT) à¤†à¤ªà¤•à¥‡ DNS à¤•à¥à¤µà¥‡à¤°à¥€ à¤•à¥‹ à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ, à¤œà¤¿à¤¸à¤¸à¥‡ à¤…à¤¨à¥à¤¯ à¤²à¥‹à¤— à¤†à¤ªà¤•à¥‡ à¤µà¤¿à¤œà¤¿à¤Ÿ à¤•à¤¿à¤ à¤—à¤ à¤µà¥‡à¤¬à¤¸à¤¾à¤‡à¤Ÿà¥à¤¸ à¤¨à¤¹à¥€à¤‚ à¤¦à¥‡à¤– à¤¸à¤•à¤¤à¥‡à¥¤ à¤‡à¤¸à¤¸à¥‡ à¤†à¤ªà¤•à¥€ à¤—à¥‹à¤ªà¤¨à¥€à¤¯à¤¤à¤¾ à¤”à¤° à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤¬à¤¢à¤¼à¤¤à¥€ à¤¹à¥ˆà¥¤",
            trustedTitle: "à¤µà¤¿à¤¶à¥à¤µà¤¸à¤¨à¥€à¤¯ DNS à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾",
            providerHead: "à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾",
            dohHead: "DoH URL",
            dotHead: "DoT à¤¹à¥‹à¤¸à¥à¤Ÿà¤¨à¤¾à¤®",
            previewTitle: "à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤² à¤ªà¥à¤°à¥€à¤µà¥à¤¯à¥‚ (XML)",
            qrTitle: "à¤¡à¤¿à¤µà¤¾à¤‡à¤¸ à¤ªà¤° à¤Ÿà¥à¤°à¤¾à¤‚à¤¸à¤«à¤° à¤•à¤°à¥‡à¤‚ (QR à¤•à¥‹à¤¡)",
            disclaimerTitle: "à¤…à¤¸à¥à¤µà¥€à¤•à¤°à¤£",
            disclaimerDesc: "à¤¯à¤¹ à¤Ÿà¥‚à¤² \"à¤œà¥ˆà¤¸à¤¾ à¤¹à¥ˆ\" à¤‰à¤ªà¤²à¤¬à¥à¤§ à¤•à¤°à¤¾à¤¯à¤¾ à¤—à¤¯à¤¾ à¤¹à¥ˆ, à¤¬à¤¿à¤¨à¤¾ à¤•à¤¿à¤¸à¥€ à¤ªà¥à¤°à¤•à¤¾à¤° à¤•à¥€ à¤µà¤¾à¤°à¤‚à¤Ÿà¥€ à¤•à¥‡à¥¤ à¤‡à¤¸ à¤Ÿà¥‚à¤² à¤•à¥‡ à¤¡à¥‡à¤µà¤²à¤ªà¤° à¤•à¤¾ à¤¸à¥‚à¤šà¥€à¤¬à¤¦à¥à¤§ DNS à¤ªà¥à¤°à¤¦à¤¾à¤¤à¤¾à¤“à¤‚ à¤¸à¥‡ à¤•à¥‹à¤ˆ à¤¸à¤‚à¤¬à¤‚à¤§ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤ à¤‡à¤¸à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤¤à¥‡ à¤¸à¤®à¤¯ à¤¸à¤­à¥€ à¤œà¥‹à¤–à¤¿à¤® à¤”à¤° à¤œà¤¿à¤®à¥à¤®à¥‡à¤¦à¤¾à¤°à¥€ à¤†à¤ªà¤•à¥€ à¤¹à¥ˆà¥¤"
          },
          fr: {
            generator: "GÃ©nÃ©rateur",
            help: "Aide & Infos",
            mainTitle: "GÃ©nÃ©rateur de profil DNS cryptÃ©",
            mainDesc: "CrÃ©ez des profils DNS sÃ©curisÃ©s pour iOS 14+, iPadOS 14+ et macOS 11+",
            labelProfileName: "Nom du profil",
            labelProvider: "PrÃ©rÃ©glage du fournisseur",
            labelResolverId: "ID du rÃ©solveur",
            labelProtocol: "Protocole DNS",
            labelDohURL: "URL du serveur DoH",
            labelDotServer: "Nom dâ€™hÃ´te du serveur DoT",
            labelServerIPs: "Adresses IP du serveur (optionnel)",
            advanced: "ParamÃ¨tres avancÃ©s",
            btnGenerate: "GÃ©nÃ©rer et tÃ©lÃ©charger le profil",
            btnSavePreset: "Enregistrer le prÃ©rÃ©glage",
            btnLoadPreset: "Charger le prÃ©rÃ©glage",
            whatTitle: "Quâ€™est-ce que le DNS cryptÃ© ?",
            whatDesc: "Le DNS cryptÃ© (DoH et DoT) sÃ©curise vos requÃªtes DNS, empÃªchant les autres de voir les sites Web que vous visitez. AmÃ©liore la confidentialitÃ© et la sÃ©curitÃ©.",
            trustedTitle: "Fournisseurs DNS de confiance",
            providerHead: "Fournisseur",
            dohHead: "URL DoH",
            dotHead: "Nom dâ€™hÃ´te DoT",
            previewTitle: "AperÃ§u du profil (XML)",
            qrTitle: "TransfÃ©rer vers lâ€™appareil (QR Code)",
            disclaimerTitle: "Avertissement",
            disclaimerDesc: "Cet outil est fourni Â« tel quel Â», sans garantie. Le dÃ©veloppeur nâ€™est affiliÃ© Ã  aucun fournisseur DNS. En utilisant cet outil, vous acceptez tous les risques."
          },
          es: {
            generator: "Generador",
            help: "Ayuda & InformaciÃ³n",
            mainTitle: "Generador de perfil DNS cifrado",
            mainDesc: "Cree perfiles DNS seguros para iOS 14+, iPadOS 14+ y macOS 11+",
            labelProfileName: "Nombre del perfil",
            labelProvider: "Proveedor preestablecido",
            labelResolverId: "ID del resolutor",
            labelProtocol: "Protocolo DNS",
            labelDohURL: "URL del servidor DoH",
            labelDotServer: "Nombre de host del servidor DoT",
            labelServerIPs: "Direcciones IP del servidor (opcional)",
            advanced: "ConfiguraciÃ³n avanzada",
            btnGenerate: "Generar y descargar perfil",
            btnSavePreset: "Guardar preestablecido",
            btnLoadPreset: "Cargar preestablecido",
            whatTitle: "Â¿QuÃ© es DNS cifrado?",
            whatDesc: "El DNS cifrado (DoH y DoT) protege sus consultas DNS, evitando que otros vean los sitios web que visita. Mejora la privacidad y la seguridad.",
            trustedTitle: "Proveedores DNS confiables",
            providerHead: "Proveedor",
            dohHead: "URL DoH",
            dotHead: "Host DoT",
            previewTitle: "Vista previa del perfil (XML)",
            qrTitle: "Transferir al dispositivo (CÃ³digo QR)",
            disclaimerTitle: "Aviso legal",
            disclaimerDesc: "Esta herramienta se proporciona tal cual, sin garantÃ­a. El desarrollador no estÃ¡ afiliado a ningÃºn proveedor DNS. Al usarla, acepta todos los riesgos."
          },
          ja: {
            generator: "ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼",
            help: "ãƒ˜ãƒ«ãƒ—ã¨æƒ…å ±",
            mainTitle: "æš—å·åŒ–DNSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ„ãƒ¼ãƒ«",
            mainDesc: "iOS 14+ã€iPadOS 14+ã€macOS 11+ç”¨ã®å®‰å…¨ãªDNSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ",
            labelProfileName: "ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å",
            labelProvider: "ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ—ãƒªã‚»ãƒƒãƒˆ",
            labelResolverId: "ãƒªã‚¾ãƒ«ãƒãƒ¼ID",
            labelProtocol: "DNSãƒ—ãƒ­ãƒˆã‚³ãƒ«",
            labelDohURL: "DoHã‚µãƒ¼ãƒãƒ¼URL",
            labelDotServer: "DoTã‚µãƒ¼ãƒãƒ¼ãƒ›ã‚¹ãƒˆå",
            labelServerIPs: "ã‚µãƒ¼ãƒãƒ¼IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä»»æ„ï¼‰",
            advanced: "è©³ç´°è¨­å®š",
            btnGenerate: "ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
            btnSavePreset: "ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜",
            btnLoadPreset: "ãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿",
            whatTitle: "æš—å·åŒ–DNSã¨ã¯ï¼Ÿ",
            whatDesc: "æš—å·åŒ–DNSï¼ˆDoHã‚„DoTï¼‰ã¯DNSã‚¯ã‚¨ãƒªã‚’ä¿è­·ã—ã€ä»–äººãŒé–²è¦§ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‰ã‚Œãªãã—ã¾ã™ã€‚ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒå‘ä¸Šã—ã¾ã™ã€‚",
            trustedTitle: "ä¿¡é ¼ã§ãã‚‹DNSãƒ—ãƒ­ãƒã‚¤ãƒ€",
            providerHead: "ãƒ—ãƒ­ãƒã‚¤ãƒ€",
            dohHead: "DoH URL",
            dotHead: "DoTãƒ›ã‚¹ãƒˆå",
            previewTitle: "ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆXMLï¼‰",
            qrTitle: "ç«¯æœ«ã«è»¢é€ï¼ˆQRã‚³ãƒ¼ãƒ‰ï¼‰",
            disclaimerTitle: "å…è²¬äº‹é …",
            disclaimerDesc: "æœ¬ãƒ„ãƒ¼ãƒ«ã¯ç¾çŠ¶ã®ã¾ã¾æä¾›ã•ã‚Œã¾ã™ã€‚ä¿è¨¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚é–‹ç™ºè€…ã¯DNSãƒ—ãƒ­ãƒã‚¤ãƒ€ã¨ææºã—ã¦ã„ã¾ã›ã‚“ã€‚åˆ©ç”¨ã¯è‡ªå·±è²¬ä»»ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚"
          },
          ko: {
            generator: "ìƒì„±ê¸°",
            help: "ë„ì›€ë§ ë° ì •ë³´",
            mainTitle: "ì•”í˜¸í™”ëœ DNS í”„ë¡œí•„ ìƒì„±ê¸°",
            mainDesc: "iOS 14+, iPadOS 14+, macOS 11+ìš© ì•ˆì „í•œ DNS í”„ë¡œí•„ ìƒì„±",
            labelProfileName: "í”„ë¡œí•„ ì´ë¦„",
            labelProvider: "ì œê³µì í”„ë¦¬ì…‹",
            labelResolverId: "ë¦¬ì¡¸ë²„ ID",
            labelProtocol: "DNS í”„ë¡œí† ì½œ",
            labelDohURL: "DoH ì„œë²„ URL",
            labelDotServer: "DoT ì„œë²„ í˜¸ìŠ¤íŠ¸ëª…",
            labelServerIPs: "ì„œë²„ IP ì£¼ì†Œ (ì„ íƒì‚¬í•­)",
            advanced: "ê³ ê¸‰ ì„¤ì •",
            btnGenerate: "í”„ë¡œí•„ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ",
            btnSavePreset: "í”„ë¦¬ì…‹ ì €ì¥",
            btnLoadPreset: "í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°",
            whatTitle: "ì•”í˜¸í™” DNSë€?",
            whatDesc: "ì•”í˜¸í™” DNS(DoH, DoT)ëŠ” DNS ì¿¼ë¦¬ë¥¼ ë³´í˜¸í•˜ì—¬ ë‹¤ë¥¸ ì‚¬ëŒì´ ë°©ë¬¸í•œ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë³¼ ìˆ˜ ì—†ë„ë¡ í•©ë‹ˆë‹¤. ê°œì¸ ì •ë³´ ë³´í˜¸ì™€ ë³´ì•ˆì´ ê°•í™”ë©ë‹ˆë‹¤.",
            trustedTitle: "ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” DNS ì œê³µì",
            providerHead: "ì œê³µì",
            dohHead: "DoH URL",
            dotHead: "DoT í˜¸ìŠ¤íŠ¸ëª…",
            previewTitle: "í”„ë¡œí•„ ë¯¸ë¦¬ë³´ê¸°(XML)",
            qrTitle: "ê¸°ê¸°ë¡œ ì „ì†¡ (QR ì½”ë“œ)",
            disclaimerTitle: "ë©´ì±… ì¡°í•­",
            disclaimerDesc: "ì´ ë„êµ¬ëŠ” ë³´ì¦ ì—†ì´ 'ìˆëŠ” ê·¸ëŒ€ë¡œ' ì œê³µë©ë‹ˆë‹¤. ê°œë°œìëŠ” ë‚˜ì—´ëœ DNS ì œê³µìì™€ ê´€ë ¨ì´ ì—†ìŠµë‹ˆë‹¤. ì‚¬ìš© ì‹œ ëª¨ë“  ìœ„í—˜ì„ ê°ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤."
          },
          ru: {
            generator: "Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€",
            help: "ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ",
            mainTitle: "Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ DNS",
            mainDesc: "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ DNS-Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ iOS 14+, iPadOS 14+ Ğ¸ macOS 11+",
            labelProfileName: "Ğ˜Ğ¼Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ",
            labelProvider: "ĞŸĞ¾ÑÑ‚Ğ°Ğ²Ñ‰Ğ¸Ğº (Ğ¿Ñ€ĞµÑĞµÑ‚)",
            labelResolverId: "ID Ñ€ĞµĞ·Ğ¾Ğ»Ğ²ĞµÑ€Ğ°",
            labelProtocol: "ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» DNS",
            labelDohURL: "URL ÑĞµÑ€Ğ²ĞµÑ€Ğ° DoH",
            labelDotServer: "Ğ¥Ğ¾ÑÑ‚Ğ½ĞµĞ¹Ğ¼ ÑĞµÑ€Ğ²ĞµÑ€Ğ° DoT",
            labelServerIPs: "IP-Ğ°Ğ´Ñ€ĞµÑĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ° (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)",
            advanced: "Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸",
            btnGenerate: "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¸ ÑĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ",
            btnSavePreset: "Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµÑĞµÑ‚",
            btnLoadPreset: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµÑĞµÑ‚",
            whatTitle: "Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ DNS?",
            whatDesc: "Ğ—Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ DNS (DoH Ğ¸ DoT) Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ²Ğ°ÑˆĞ¸ DNS-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹, Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ÑĞµÑ‰Ğ°ĞµĞ¼Ñ‹Ñ… ÑĞ°Ğ¹Ñ‚Ğ¾Ğ². ĞŸĞ¾Ğ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ.",
            trustedTitle: "ĞĞ°Ğ´ĞµĞ¶Ğ½Ñ‹Ğµ DNS-Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ñ‰Ğ¸ĞºĞ¸",
            providerHead: "ĞŸĞ¾ÑÑ‚Ğ°Ğ²Ñ‰Ğ¸Ğº",
            dohHead: "DoH URL",
            dotHead: "DoT Ñ…Ğ¾ÑÑ‚Ğ½ĞµĞ¹Ğ¼",
            previewTitle: "ĞŸÑ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ (XML)",
            qrTitle: "ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ Ğ½Ğ° ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ (QR-ĞºĞ¾Ğ´)",
            disclaimerTitle: "ĞÑ‚ĞºĞ°Ğ· Ğ¾Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸",
            disclaimerDesc: "Ğ­Ñ‚Ğ¾Ñ‚ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Â«ĞºĞ°Ğº ĞµÑÑ‚ÑŒÂ», Ğ±ĞµĞ· ĞºĞ°ĞºĞ¸Ñ…-Ğ»Ğ¸Ğ±Ğ¾ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ğ¹. Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ½Ğµ ÑĞ²ÑĞ·Ğ°Ğ½ Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ DNS-Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ñ‰Ğ¸ĞºĞ°Ğ¼Ğ¸. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚, Ğ²Ñ‹ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚Ğµ Ğ²ÑĞµ Ñ€Ğ¸ÑĞºĞ¸."
          },
          zh: {
            generator: "ç”Ÿæˆå™¨",
            help: "å¸®åŠ©ä¸ä¿¡æ¯",
            mainTitle: "åŠ å¯†DNSé…ç½®æ–‡ä»¶ç”Ÿæˆå™¨",
            mainDesc: "ä¸ºiOS 14+ã€iPadOS 14+å’ŒmacOS 11+åˆ›å»ºå®‰å…¨çš„DNSé…ç½®æ–‡ä»¶",
            labelProfileName: "é…ç½®æ–‡ä»¶åç§°",
            labelProvider: "æä¾›å•†é¢„è®¾",
            labelResolverId: "è§£æå™¨ID",
            labelProtocol: "DNSåè®®",
            labelDohURL: "DoHæœåŠ¡å™¨URL",
            labelDotServer: "DoTæœåŠ¡å™¨ä¸»æœºå",
            labelServerIPs: "æœåŠ¡å™¨IPåœ°å€ï¼ˆå¯é€‰ï¼‰",
            advanced: "é«˜çº§è®¾ç½®",
            btnGenerate: "ç”Ÿæˆå¹¶ä¸‹è½½é…ç½®æ–‡ä»¶",
            btnSavePreset: "ä¿å­˜é¢„è®¾",
            btnLoadPreset: "åŠ è½½é¢„è®¾",
            whatTitle: "ä»€ä¹ˆæ˜¯åŠ å¯†DNSï¼Ÿ",
            whatDesc: "åŠ å¯†DNSï¼ˆå¦‚DoHå’ŒDoTï¼‰å¯ä»¥ä¿æŠ¤æ‚¨çš„DNSæŸ¥è¯¢ï¼Œé˜²æ­¢ä»–äººæŸ¥çœ‹æ‚¨è®¿é—®çš„ç½‘ç«™ã€‚æé«˜éšç§ä¸å®‰å…¨æ€§ã€‚",
            trustedTitle: "å¯ä¿¡DNSæä¾›å•†",
            providerHead: "æä¾›å•†",
            dohHead: "DoH URL",
            dotHead: "DoTä¸»æœºå",
            previewTitle: "é…ç½®æ–‡ä»¶é¢„è§ˆï¼ˆXMLï¼‰",
            qrTitle: "è½¬ç§»åˆ°è®¾å¤‡ï¼ˆäºŒç»´ç ï¼‰",
            disclaimerTitle: "å…è´£å£°æ˜",
            disclaimerDesc: "æœ¬å·¥å…·æŒ‰â€œåŸæ ·â€æä¾›ï¼Œä¸ä½œä»»ä½•ä¿è¯ã€‚å¼€å‘è€…ä¸ä»»ä½•DNSæä¾›å•†æ— å…³ã€‚ä½¿ç”¨æœ¬å·¥å…·å³è¡¨ç¤ºæ‚¨æ¥å—æ‰€æœ‰é£é™©ã€‚"
          }

        };

        this.providers = {
          custom: { name: "Custom", doh: "", dot: "", requiresId: false },
          cloudflare: { name: "Cloudflare", doh: "https://cloudflare-dns.com/dns-query", dot: "1dot1dot1dot1.cloudflare-dns.com", requiresId: false, icon: 'cloudflare' },
          google: { name: "Google", doh: "https://dns.google/dns-query", dot: "dns.google", requiresId: false, icon: 'google' },
          quad9: { name: "Quad9", doh: "https://dns.quad9.net/dns-query", dot: "dns.quad9.net", requiresId: false, icon: 'quad9' },
          nextdns: { name: "NextDNS", doh: "https://dns.nextdns.io/YOUR-ID", dot: "YOUR-ID.dns.nextdns.io", requiresId: true, icon: 'nextdns' },
          controld: { name: "Control D", doh: "https://dns.controld.com/YOUR-ID", dot: "YOUR-ID.dns.controld.com", requiresId: true, icon: 'controld' },
          mullvad: { name: "Mullvad DNS", doh: "https://dns.mullvad.net/dns-query", dot: "dns.mullvad.net", requiresId: false, icon: 'mullvad' },
          opendns: { name: "OpenDNS", doh: "https://doh.opendns.com/dns-query", dot: "dns.opendns.com", requiresId: false, icon: 'opendns' },
        };
        this.lang = localStorage.getItem('dnsLang') || 'en';
        this.initializeElements();
        this.setLanguage(this.lang);
        this.populateProviders();
        this.bindEvents();
        this.initializeForm();
        this.themeInit();
      }

      initializeElements() {
        this.form = document.getElementById('dns-form');
        this.providerSelect = document.getElementById('provider');
        this.protocolSelect = document.getElementById('protocol');
        this.dohURLInput = document.getElementById('dohURL');
        this.dotServerInput = document.getElementById('dotServer');
        this.profileNameInput = document.getElementById('profileName');
        this.serverIPsInput = document.getElementById('serverIPs');
        this.resolverIdGroup = document.getElementById('resolver-id-group');
        this.resolverIdInput = document.getElementById('resolverId');
        this.messagesContainer = document.getElementById('form-messages');
        this.generateBtn = document.getElementById('generate-btn');
        this.btnText = document.getElementById('btn-text');
        this.dohFields = document.getElementById('doh-fields');
        this.dotFields = document.getElementById('dot-fields');
        this.advancedToggle = document.getElementById('advanced-toggle');
        this.advancedSettings = document.getElementById('advanced-settings');
        this.tabGenerator = document.getElementById('tab-generator');
        this.tabHelp = document.getElementById('tab-help');
        this.contentGenerator = document.getElementById('content-generator');
        this.contentHelp = document.getElementById('content-help');
        this.providerInfoTable = document.getElementById('provider-info-table');
        this.profilePreviewContainer = document.getElementById('profile-preview-container');
        this.profilePreview = document.getElementById('profile-preview');
        this.qrCodeContainer = document.getElementById('qr-code-container');
        this.qrCode = document.getElementById('qr-code');
        this.langSelect = document.getElementById('lang-select');
        this.themeToggle = document.getElementById('theme-toggle');
        this.savePresetBtn = document.getElementById('save-preset-btn');
        this.loadPresetBtn = document.getElementById('load-preset-btn');
      }

      setLanguage(lang) {
        this.lang = lang;
        localStorage.setItem('dnsLang', lang);
        const t = this.translations[lang];
        document.getElementById('main-title').textContent = t.mainTitle;
        document.getElementById('main-desc').textContent = t.mainDesc;
        document.getElementById('label-profileName').innerHTML = t.labelProfileName + ' <span class="text-[var(--accent-error)]">*</span>';
        document.getElementById('label-provider').textContent = t.labelProvider;
        document.getElementById('label-resolverId').innerHTML = t.labelResolverId + ' <span class="text-[var(--accent-error)]">*</span>';
        document.getElementById('label-protocol').textContent = t.labelProtocol;
        document.getElementById('label-dohURL').innerHTML = t.labelDohURL + ' <span class="text-[var(--accent-error)]">*</span>';
        document.getElementById('label-dotServer').innerHTML = t.labelDotServer + ' <span class="text-[var(--accent-error)]">*</span>';
        document.getElementById('label-serverIPs').textContent = t.labelServerIPs;
        this.advancedToggle.textContent = t.advanced;
        this.btnText.textContent = t.btnGenerate;
        this.savePresetBtn.textContent = t.btnSavePreset;
        this.loadPresetBtn.textContent = t.btnLoadPreset;
        this.tabGenerator.textContent = t.generator;
        this.tabHelp.textContent = t.help;
        document.getElementById('what-title').textContent = t.whatTitle;
        document.getElementById('what-desc').textContent = t.whatDesc;
        document.getElementById('trusted-title').textContent = t.trustedTitle;
        document.getElementById('provider-head').textContent = t.providerHead;
        document.getElementById('doh-head').textContent = t.dohHead;
        document.getElementById('dot-head').textContent = t.dotHead;
        document.getElementById('preview-title').textContent = t.previewTitle;
        document.getElementById('qr-title').textContent = t.qrTitle;
        document.getElementById('disclaimer-title').textContent = t.disclaimerTitle;
        document.getElementById('disclaimer-desc').textContent = t.disclaimerDesc;
      }

      themeInit() {
        this.themeToggle.addEventListener('click', () => {
          document.body.classList.toggle('light');
          localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
        });
        if (localStorage.getItem('theme') === 'light') {
          document.body.classList.add('light');
        }
      }

      populateProviders() {
        Object.entries(this.providers).forEach(([key, { name, doh, dot, icon }]) => {
          const option = document.createElement('option');
          option.value = key;
          option.textContent = name;
          this.providerSelect.appendChild(option);

          if (key !== 'custom') {
            const row = this.providerInfoTable.insertRow();
            row.innerHTML = `
              <td class="p-4 font-semibold flex items-center gap-2">${this.getProviderIcon(icon)}${name}</td>
              <td class="p-4 relative"><code>${doh}</code><span class="copy-icon-table" data-copy="${doh}">${this.getCopyIcon()}</span></td>
              <td class="p-4 relative"><code>${dot}</code><span class="copy-icon-table" data-copy="${dot}">${this.getCopyIcon()}</span></td>
            `;
          }
        });
      }

      bindEvents() {
        this.tabGenerator.addEventListener('click', () => this.switchTab('generator'));
        this.tabHelp.addEventListener('click', () => this.switchTab('help'));
        this.tabGenerator.addEventListener('keydown', (e) => { if(e.key === "ArrowRight" || e.key === "ArrowLeft") { this.tabHelp.focus(); } });
        this.tabHelp.addEventListener('keydown', (e) => { if(e.key === "ArrowRight" || e.key === "ArrowLeft") { this.tabGenerator.focus(); } });
        this.providerSelect.addEventListener('change', () => this.handleProviderChange());
        this.protocolSelect.addEventListener('change', () => this.handleProtocolChange());
        this.resolverIdInput.addEventListener('input', () => this.updateServerUrls());
        this.form.addEventListener('submit', (e) => this.handleFormSubmit(e));
        this.advancedToggle.addEventListener('click', () => this.advancedSettings.classList.toggle('hidden'));
        this.providerInfoTable.addEventListener('click', (e) => {
          const target = e.target.closest('.copy-icon-table');
          if (target) {
            this.copyToClipboard(target.dataset.copy, target);
          }
        });
        this.savePresetBtn.addEventListener('click', () => {
          localStorage.setItem('dnsPreset', JSON.stringify(this.gatherFormData()));
          this.showMessage('Preset saved!', 'success');
        });
        this.loadPresetBtn.addEventListener('click', () => {
          const preset = localStorage.getItem('dnsPreset');
          if (preset) {
            const data = JSON.parse(preset);
            this.profileNameInput.value = data.profileName;
            this.protocolSelect.value = data.protocol;
            this.dohURLInput.value = data.dohURL;
            this.dotServerInput.value = data.dotServer;
            this.serverIPsInput.value = data.serverIPs.join('\n');
            this.showMessage('Preset loaded!', 'success');
            this.handleProtocolChange();
          } else {
            this.showMessage('No preset found.', 'error');
          }
        });
        this.langSelect.addEventListener('change', (e) => this.setLanguage(e.target.value));
      }

      initializeForm() {
        this.handleProviderChange();
        this.handleProtocolChange();
      }

      switchTab(tabName) {
        const isGenerator = tabName === 'generator';
        this.tabGenerator.classList.toggle('active', isGenerator);
        this.tabHelp.classList.toggle('active', !isGenerator);
        this.contentGenerator.classList.toggle('active', isGenerator);
        this.contentGenerator.classList.toggle('hidden', !isGenerator);
        this.contentHelp.classList.toggle('active', !isGenerator);
        this.contentHelp.classList.toggle('hidden', isGenerator);
      }

      updateServerUrls() {
        const provider = this.providers[this.providerSelect.value];
        if (!provider) return;
        const resolverId = this.resolverIdInput.value.trim();
        const displayId = resolverId || 'YOUR-ID';
        if (provider.requiresId) {
          this.dohURLInput.value = provider.doh.replace('YOUR-ID', displayId);
          this.dotServerInput.value = provider.dot.replace('YOUR-ID', displayId);
        } else {
          this.dohURLInput.value = provider.doh;
          this.dotServerInput.value = provider.dot;
        }
      }

      handleProviderChange() {
        const provider = this.providers[this.providerSelect.value];
        const isCustom = this.providerSelect.value === 'custom';
        this.serverIPsInput.value = '';
        this.dohURLInput.readOnly = !isCustom;
        this.dotServerInput.readOnly = !isCustom;
        if (provider.requiresId) {
          this.resolverIdGroup.classList.remove('hidden');
          this.resolverIdInput.required = true;
        } else {
          this.resolverIdGroup.classList.add('hidden');
          this.resolverIdInput.required = false;
          this.resolverIdInput.value = '';
        }
        this.updateServerUrls();
      }

      handleProtocolChange() {
        const isDoH = this.protocolSelect.value === 'doh';
        this.dohFields.style.display = isDoH ? 'block' : 'none';
        this.dotFields.style.display = isDoH ? 'none' : 'block';
        this.dohURLInput.required = isDoH;
        this.dotServerInput.required = !isDoH;
      }

      validateForm() {
        this.clearMessages();
        const schema = {
          profileName: { required: true, maxLength: 50 },
          resolverId: { required: this.providers[this.providerSelect.value].requiresId },
          dohURL: { required: this.protocolSelect.value === 'doh', pattern: /^https:\/\/.+/ },
          dotServer: { required: this.protocolSelect.value === 'dot' },
        };
        for (const [field, rules] of Object.entries(schema)) {
          const input = this[field + 'Input'];
          if (!input) continue;
          const value = input.value.trim();
          const label = document.querySelector(`label[for=${field}]`).textContent.replace('*','').trim();
          if (rules.required && !value) {
            this.showMessage(`${label} is required.`, 'error');
            return false;
          }
          if (rules.maxLength && value.length > rules.maxLength) {
            this.showMessage(`${label} is too long.`, 'error');
            return false;
          }
          if (rules.pattern && value && !rules.pattern.test(value)) {
            this.showMessage(`Invalid format for ${label}.`, 'error');
            return false;
          }
        }
        return true;
      }

      showMessage(message, type = 'error') {
        this.clearMessages();
        const messageDiv = document.createElement('div');
        messageDiv.className = `message-box ${type}-message fade-in`;
        messageDiv.textContent = message;
        this.messagesContainer.appendChild(messageDiv);
      }

      clearMessages() {
        this.messagesContainer.innerHTML = '';
      }

      async handleFormSubmit(event) {
        event.preventDefault();
        if (!this.validateForm()) return;
        this.setButtonLoading(true);
        try {
          const formData = this.gatherFormData();
          const profileContent = this.generateMobileConfigXML(formData);
          if (!this.validateXML(profileContent)) throw new Error('Generated profile is invalid.');
          this.showProfilePreview(profileContent);
          this.downloadProfile(profileContent, formData);
          this.showMessage('Profile generated successfully!', 'success');
        } catch (error) {
          this.showMessage(error.message || 'Failed to generate profile.', 'error');
        } finally {
          this.setButtonLoading(false);
        }
      }

      setButtonLoading(isLoading) {
        this.generateBtn.disabled = isLoading;
        this.btnText.innerHTML = isLoading ? `<span class="loading-spinner"></span>Generating...` : this.translations[this.lang].btnGenerate;
      }

      downloadProfile(content, formData) {
        const blob = new Blob([content], { type: 'application/x-apple-aspen-config' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${this.createSafeFilename(formData.profileName)}.mobileconfig`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        this.showQRCode(url);
      }

      gatherFormData() {
        const provider = this.providers[this.providerSelect.value];
        const resolverId = this.resolverIdInput.value.trim();
        let dohURL = this.dohURLInput.value.trim();
        let dotServer = this.dotServerInput.value.trim();
        if (provider.requiresId && resolverId) {
          dohURL = provider.doh.replace('YOUR-ID', resolverId);
          dotServer = provider.dot.replace('YOUR-ID', resolverId);
        }
        return {
          profileName: this.sanitizeInput(this.profileNameInput.value),
          protocol: this.protocolSelect.value,
          dohURL: this.sanitizeInput(dohURL),
          dotServer: this.sanitizeInput(dotServer),
          serverIPs: this.serverIPsInput.value.split('\n').map(ip => this.sanitizeInput(ip)).filter(Boolean),
        };
      }

      generateMobileConfigXML(data) {
        const payloadUUID = self.crypto.randomUUID().toUpperCase();
        const profileUUID = self.crypto.randomUUID().toUpperCase();
        const serverAddressesXML = data.serverIPs.length > 0
          ? `<key>ServerAddresses</key><array>${data.serverIPs.map(ip => `<string>${this.escapeXML(ip)}</string>`).join('')}</array>`
          : '';
        const protocolConfig = data.protocol === 'doh'
          ? `<key>ServerURL</key><string>${this.escapeXML(data.dohURL)}</string>`
          : `<key>ServerName</key><string>${this.escapeXML(data.dotServer)}</string>`;
        return `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0"><dict>
<key>PayloadContent</key><array><dict>
<key>DNSSettings</key><dict>
<key>DNSProtocol</key><string>${data.protocol === 'doh' ? 'HTTPS' : 'TLS'}</string>
${protocolConfig}${serverAddressesXML}
</dict>
<key>PayloadDescription</key><string>Encrypted DNS configuration</string>
<key>PayloadDisplayName</key><string>Encrypted DNS: ${this.escapeXML(data.profileName)}</string>
<key>PayloadIdentifier</key><string>com.apple.dnsSettings.managed.${payloadUUID}</string>
<key>PayloadType</key><string>com.apple.dnsSettings.managed</string>
<key>PayloadUUID</key><string>${payloadUUID}</string>
<key>PayloadVersion</key><integer>1</integer>
</dict></array>
<key>PayloadDisplayName</key><string>${this.escapeXML(data.profileName)}</string>
<key>PayloadIdentifier</key><string>com.encrypted-dns-generator.${profileUUID}</string>
<key>PayloadRemovalDisallowed</key><false/>
<key>PayloadType</key><string>Configuration</string>
<key>PayloadUUID</key><string>${profileUUID}</string>
<key>PayloadVersion</key><integer>1</integer>
</dict></plist>`;
      }

      sanitizeInput(input) {
        const div = document.createElement('div');
        div.textContent = input;
        return div.innerHTML.trim();
      }

      escapeXML(str) {
        return str.replace(/[<>&"']/g, c => ({'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;',"'":'&apos;'})[c]);
      }

      createSafeFilename(name) {
        return name.replace(/[^a-z0-9\-_.]/gi, '_').toLowerCase() || 'encrypted_dns';
      }

      validateXML(xml) {
        return !new DOMParser().parseFromString(xml, "application/xml").querySelector("parsererror");
      }

      getCopyIcon() {
        return `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M9 5H7a2 2 0 00-2 2v8a2 2 0 002 2h2m4 0h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2z"></path></svg>`;
      }

      getProviderIcon(key) {
        switch(key) {
          case 'cloudflare': return '<svg width="22" height="22" viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="20" fill="#F38020"/><path d="M14 32h20a8 8 0 10-16 0z" fill="#fff"/></svg>';
          case 'google': return '<svg width="22" height="22" viewBox="0 0 48 48"><circle cx="24" cy="24" r="20" fill="#4285F4"/><text x="24" y="32" text-anchor="middle" font-size="20" fill="#fff">G</text></svg>';
          case 'quad9': return '<svg width="22" height="22" viewBox="0 0 48 48"><circle cx="24" cy="24" r="20" fill="#D9006C"/><text x="24" y="32" text-anchor="middle" font-size="20" fill="#fff">9</text></svg>';
          case 'nextdns': return '<svg width="22" height="22" viewBox="0 0 48 48"><rect x="8" y="8" width="32" height="32" rx="8" fill="#0F172A"/><text x="24" y="32" text-anchor="middle" font-size="16" fill="#38BDF8">NX</text></svg>';
          case 'controld': return '<svg width="22" height="22" viewBox="0 0 48 48"><rect x="8" y="8" width="32" height="32" rx="8" fill="#1E293B"/><text x="24" y="32" text-anchor="middle" font-size="16" fill="#F59E0B">CD</text></svg>';
          case 'mullvad': return '<svg width="22" height="22" viewBox="0 0 48 48"><circle cx="24" cy="24" r="20" fill="#6B7280"/><text x="24" y="32" text-anchor="middle" font-size="16" fill="#FBBF24">MV</text></svg>';
          case 'opendns': return '<svg width="22" height="22" viewBox="0 0 48 48"><rect x="8" y="8" width="32" height="32" rx="8" fill="#F59E0B"/><text x="24" y="32" text-anchor="middle" font-size="16" fill="#fff">OD</text></svg>';
          default: return '';
        }
      }

      copyToClipboard(text, element) {
        navigator.clipboard.writeText(text).then(() => {
          element.style.color = "var(--accent-success)";
          setTimeout(() => { element.style.color = "var(--text-muted)"; }, 1200);
        });
      }

      showProfilePreview(profileContent) {
        this.profilePreview.textContent = profileContent;
        this.profilePreviewContainer.classList.remove('hidden');
      }

      showQRCode(downloadUrl) {
        if (this.qrCode) {
          new QRious({ element: this.qrCode, value: downloadUrl, size: 180 });
          this.qrCodeContainer.classList.remove('hidden');
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      try {
        new DNSProfileGenerator();
      } catch (error) {
        console.error('Initialization error:', error);
        document.body.innerHTML = '<div class="error-message">Failed to initialize application.</div>';
      }
    });
  </script>
</body>
</html>
